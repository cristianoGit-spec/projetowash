<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Quatro Cantos - Sistema de Gestao Empresarial">
    <meta name="theme-color" content="#2563eb">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/static/manifest.json">
    <link rel="apple-touch-icon" href="/static/icons/icon-192x192.png">
    
    <title>Quatro Cantos - Sistema de Gestao</title>
    
    <!-- CSS - Novo Layout PrescrMed -->
    <link rel="stylesheet" href="/static/css/prescrimed-layout.css?v=41">
    <link rel="stylesheet" href="/static/css/admin.css?v=42">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- jsPDF - Gera√ß√£o de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Firebase SDK (Sistema H√≠brido - Nuvem + Local) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Segments Config -->
    <script src="/static/js/segments-config.js?v=17"></script>
    
    <!-- Limpeza de Cache v40 - Layout PrescrMed -->
    <script>
        // Limpar cache antigo do Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for (let registration of registrations) {
                    registration.unregister();
                }
            });
            
            // Limpar todos os caches antigos
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        if (name !== 'estoque-certo-v41') {
                            console.log('[CACHE] Removendo cache antigo:', name);
                            caches.delete(name);
                        }
                    }
                });
            }
        }
        
        // Sistema Profissional v41 - Layout PrescrMed
        if (!localStorage.getItem('system_prescrimed_v41')) {
            console.log('[SYSTEM] Quatro Cantos v41 - Layout PrescrMed Inspirado');
            // Limpar flags antigas
            localStorage.removeItem('system_professional_v39');
            localStorage.removeItem('system_prescrimed_v40');
            localStorage.setItem('system_prescrimed_v41', 'true');
            console.log('[INFO] Novo layout com sidebar lateral e design moderno');
        }
    </script>
</head>
<body>
    
    <!-- CONTAINER DE AUTENTICACAO -->
    <div id="authContainer" class="auth-wrapper">
        <!-- Lado Esquerdo - Banner -->
        <div class="auth-banner">
            <div class="banner-content">
                <i class="fas fa-warehouse"></i>
                <h1>Domine seu Estoque.<br>Maximize seus Lucros.</h1>
                <p>A solu√ß√£o completa para gest√£o inteligente, segura e eficiente do seu neg√≥cio.</p>
            </div>
        </div>

        <!-- Lado Direito - Conte√∫do -->
        <div class="auth-content">
            <!-- Login Form -->
            <div id="loginForm" class="auth-card">
                <div class="auth-header">
                    <i class="fas fa-warehouse auth-icon-large"></i>
                    <h2>Bem-vindo de volta</h2>
                    <p>Acesse sua conta para continuar</p>
                </div>
                
                <form onsubmit="handleLogin(event)" class="auth-form">
                    <div class="form-group">
                        <label for="loginEmail">Email ou Usu√°rio</label>
                        <div class="input-group">
                            <input type="text" id="loginEmail" required placeholder="seu@email.com">
                            <i class="fas fa-envelope"></i>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Senha</label>
                        <div class="input-group">
                            <input type="password" id="loginPassword" required placeholder="Sua senha">
                            <i class="fas fa-lock"></i>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-block">
                        Entrar no Sistema
                    </button>
                    
                    <div class="login-buttons-container">
                        <button type="button" onclick="loginRapido('superadmin')" class="btn-login-superadmin" aria-label="Login r√°pido como Super Administrador">
                            <i class="fas fa-shield-alt"></i> Super Admin
                        </button>
                        <button type="button" onclick="loginRapido('admin')" class="btn-login-admin" aria-label="Login r√°pido como Administrador">
                            <i class="fas fa-user-shield"></i> Admin
                        </button>
                    </div>
                </form>
                
                <div class="auth-links">
                    <a href="#" onclick="showForgotPassword()">Esqueceu a senha?</a>
                    <span class="auth-separator">|</span>
                    N√£o tem conta? <a href="#" onclick="showRegister()">Criar conta</a>
                </div>
                
                <div class="admin-login-hint">
                    <i class="fas fa-info-circle"></i>
                    <p><strong>Modo Demo:</strong> Admin: admin@local.com / admin123 | Super Admin: superadmin@quatrocantos.com / admin@2025</p>
                    <button onclick="resetLocalStorage()" class="btn-reset-storage" aria-label="Resetar usu√°rios de demonstra√ß√£o">
                        <i class="fas fa-sync-alt"></i> Resetar Usu√°rios Demo
                    </button>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="auth-card hidden">
                <div class="auth-header">
                    <h2>Criar Conta</h2>
                    <p>Cadastre sua empresa no sistema</p>
                </div>
                
                <form onsubmit="handleRegister(event)" class="auth-form">
                    <input type="hidden" id="regType" value="empresa">
                    
                    <!-- Campos Comuns -->
                    <div class="form-group">
                        <label for="regNome">Nome Completo</label>
                        <div class="input-group">
                            <input type="text" id="regNome" required placeholder="Seu nome completo">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="regEmail">Email</label>
                        <div class="input-group">
                            <input type="email" id="regEmail" required placeholder="seu@email.com">
                            <i class="fas fa-envelope"></i>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="regContato">Contato</label>
                        <div class="input-group">
                            <input type="tel" id="regContato" required placeholder="(00) 00000-0000">
                            <i class="fas fa-phone"></i>
                        </div>
                    </div>

                    <!-- Campos Empresa -->
                    <div id="fieldsEmpresa">
                        <div class="form-group">
                            <label for="regNomeEmpresa">Nome da Empresa</label>
                            <div class="input-group">
                                <input type="text" id="regNomeEmpresa" required placeholder="Nome da sua empresa">
                                <i class="fas fa-building"></i>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="regSegmento">Segmento da Empresa</label>
                            <div class="input-group">
                                <select id="regSegmento" required class="form-select select-with-icon" onchange="aplicarTemaSegmento(this.value)">
                                    <option value="" disabled selected>Selecione o segmento</option>
                                    <option value="construcao">Constru√ß√£o Civil</option>
                                    <option value="varejo">Varejo</option>
                                    <option value="servicos">Servi√ßos</option>
                                    <option value="industria">Ind√∫stria</option>
                                    <option value="logistica">Log√≠stica</option>
                                    <option value="outros">Outros</option>
                                </select>
                                <i class="fas fa-industry"></i>
                            </div>
                            <small class="segmento-info-text">
                                O layout se adaptar√° ao seu segmento
                            </small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="regLogin">Login de Usu√°rio</label>
                        <div class="input-group">
                            <input type="text" id="regLogin" required placeholder="usuario123">
                            <i class="fas fa-id-card"></i>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="regPassword">Senha</label>
                        <div class="input-group">
                            <input type="password" id="regPassword" required placeholder="Minimo 6 caracteres">
                            <i class="fas fa-lock"></i>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="regPasswordConfirm">Confirmar Senha</label>
                        <div class="input-group">
                            <input type="password" id="regPasswordConfirm" required placeholder="Digite novamente">
                            <i class="fas fa-lock"></i>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-block">
                        <span id="btnRegisterText">Cadastrar Empresa</span>
                    </button>
                </form>
                
                <div class="auth-links">
                    J√° tem uma conta? <a href="#" onclick="showLogin()">Fazer login</a>
                </div>
            </div>
            
            <!-- Forgot Password Form -->
            <div id="forgotPasswordForm" class="auth-card hidden">
                <div class="auth-header">
                    <h2>Recuperar Senha</h2>
                    <p>Digite seu email para receber instru√ß√µes</p>
                </div>
                
                <form onsubmit="handleForgotPassword(event)" class="auth-form">
                    <div class="form-group">
                        <label for="forgotEmail">Email</label>
                        <div class="input-group">
                            <input type="email" id="forgotEmail" required placeholder="seu@email.com">
                            <i class="fas fa-envelope"></i>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-block">
                        Enviar Email
                    </button>
                </form>
                
                <div class="auth-links">
                    <a href="#" onclick="showLogin()">Voltar para login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTAINER DO APLICATIVO - NOVO LAYOUT PRESCRIMED -->
    <div id="appContainer" class="app-layout hidden">
        
        <!-- Sidebar Lateral Fixa -->
        <aside class="sidebar" id="sidebar">
            <!-- Logo -->
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">
                    <i class="fas fa-warehouse"></i>
                </div>
                <div class="sidebar-logo-text">
                    <h2>Quatro Cantos</h2>
                    <p id="sidebarCompanyName">Sistema de Gest√£o</p>
                </div>
            </div>

            <!-- Navega√ß√£o -->
            <nav class="sidebar-nav">
                <div class="nav-group">
                    <div class="nav-group-title">Principal</div>
                    <a href="#" class="nav-item active" onclick="showModule('dashboard'); return false;">
                        <i class="fas fa-th-large"></i>
                        <span>Dashboard</span>
                    </a>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">Opera√ß√µes</div>
                    <a href="#" class="nav-item" onclick="showModule('operacional'); return false;">
                        <i class="fas fa-industry"></i>
                        <span>Operacional</span>
                    </a>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">Estoque</div>
                    <a href="#" class="nav-item" onclick="showModule('estoque-entrada'); return false;">
                        <i class="fas fa-box-open"></i>
                        <span>Entrada</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showModule('estoque-saida'); return false;">
                        <i class="fas fa-truck-loading"></i>
                        <span>Sa√≠da</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showModule('visualizar'); return false;">
                        <i class="fas fa-boxes"></i>
                        <span>Saldo Atual</span>
                    </a>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">Gest√£o</div>
                    <a href="#" class="nav-item" onclick="showModule('financeiro'); return false;">
                        <i class="fas fa-chart-line"></i>
                        <span>Financeiro</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showModule('rh'); return false;">
                        <i class="fas fa-users"></i>
                        <span>Recursos Humanos</span>
                    </a>
                </div>

                <div class="nav-group admin-only hidden">
                    <div class="nav-group-title">Administra√ß√£o</div>
                    <a href="#" class="nav-item" onclick="showModule('historico'); return false;">
                        <i class="fas fa-history"></i>
                        <span>Hist√≥rico</span>
                    </a>
                </div>

                <div class="nav-group superadmin-only hidden">
                    <div class="nav-group-title">Super Admin</div>
                    <a href="#" class="nav-item" onclick="showModule('gestao-empresas'); return false;">
                        <i class="fas fa-building"></i>
                        <span>Gest√£o de Empresas</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showModule('admin'); return false;">
                        <i class="fas fa-shield-alt"></i>
                        <span>Painel Admin</span>
                    </a>
                </div>
            </nav>

            <!-- Footer da Sidebar -->
            <div class="sidebar-footer">
                <div class="sidebar-user" onclick="toggleUserMenu()">
                    <div class="sidebar-user-avatar" id="sidebarUserAvatar">U</div>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-name" id="sidebarUserName">Usu√°rio</div>
                        <div class="sidebar-user-role" id="sidebarUserRole">Admin</div>
                    </div>
                    <i class="fas fa-chevron-up" style="color: var(--sidebar-text); font-size: 0.875rem;"></i>
                </div>
            </div>
        </aside>

        <!-- Overlay para Mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleMobileMenu()"></div>

        <!-- √Årea de Conte√∫do Principal -->
        <div class="main-content" id="mainContent">
            
            <!-- Topbar -->
            <header class="topbar">
                <div class="topbar-left">
                    <button class="menu-toggle" onclick="toggleMobileMenu()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="topbar-title">
                        <h1 id="pageTitle">Dashboard</h1>
                        <div class="breadcrumb" id="breadcrumb">
                            <div class="breadcrumb-item"><i class="fas fa-home"></i> In√≠cio</div>
                            <div class="breadcrumb-item active">Dashboard</div>
                        </div>
                    </div>
                </div>

                <div class="topbar-actions">
                    <!-- Busca -->
                    <div class="topbar-search">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Buscar...">
                    </div>

                    <!-- Notifica√ß√µes -->
                    <button class="topbar-icon-btn" title="Notifica√ß√µes">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </button>

                    <!-- Instalar App -->
                    <button id="installBtn" class="btn btn-primary hidden" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        <i class="fas fa-download"></i>
                        <span>Instalar</span>
                    </button>

                    <!-- User Menu Dropdown -->
                    <div class="user-menu" style="position: relative;">
                        <button class="topbar-icon-btn" onclick="toggleUserMenu()" title="Menu do usu√°rio">
                            <i class="fas fa-user-circle" style="font-size: 1.5rem;"></i>
                        </button>
                        
                        <div id="userMenuDropdown" class="user-menu-dropdown hidden" style="position: absolute; right: 0; top: 100%; margin-top: 0.5rem;">
                            <div class="company-header" style="padding: 1rem; background: linear-gradient(135deg, var(--primary-blue), var(--primary-light)); color: white; border-radius: var(--radius-md) var(--radius-md) 0 0;">
                                <i class="fas fa-building"></i>
                                <div>
                                    <small style="opacity: 0.9; font-size: 0.75rem;">Empresa:</small>
                                    <strong id="companyName" style="display: block; margin: 0.25rem 0;">Carregando...</strong>
                                    <small id="userEmail" style="opacity: 0.8; font-size: 0.75rem;">usuario@email.com</small>
                                </div>
                            </div>
                            <div style="padding: 0.5rem 0;">
                                <a href="#" onclick="showProfile(); return false;" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: var(--text-primary); text-decoration: none; transition: var(--transition);">
                                    <i class="fas fa-user"></i> Meu Perfil
                                </a>
                                <a href="#" onclick="showConfig(); return false;" class="admin-only hidden" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: var(--text-primary); text-decoration: none; transition: var(--transition);">
                                    <i class="fas fa-cog"></i> Configura√ß√µes
                                </a>
                                <hr style="margin: 0.5rem 0; border: none; border-top: 1px solid #f1f5f9;">
                                <a href="#" onclick="handleLogout(); return false;" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: var(--danger); text-decoration: none; transition: var(--transition);">
                                    <i class="fas fa-sign-out-alt"></i> Sair
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- √Årea de Conte√∫do -->
            <div class="content-area" id="contentArea">
                
                <!-- Dashboard Section (Carregado inicialmente) -->
                <section id="dashboardSection" class="dashboard-section">
                    <!-- Alertas de Estoque Baixo -->
                    <div id="stockAlerts" class="hidden"></div>
                    
                    <!-- Cards de Estat√≠sticas -->
                    <div class="cards-grid">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Total de Produtos</div>
                                <div class="stat-value" id="statTotalProdutos">0</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-cubes"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Itens em Estoque</div>
                                <div class="stat-value" id="statTotalItens">0</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon purple">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Valor em Estoque</div>
                                <div class="stat-value" id="statValorTotal">R$ 0,00</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Vendas do M√™s</div>
                                <div class="stat-value" id="statVendasMes">R$ 0,00</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gr√°ficos -->
                    <div class="cards-grid mt-4">
                        <div class="card">
                            <div class="card-header">
                                <h3>Movimenta√ß√µes Recentes</h3>
                            </div>
                            <div class="card-body">
                                <canvas id="chartMovimentacoes"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3>Top 5 Produtos</h3>
                            </div>
                            <div class="card-body">
                                <canvas id="chartTopProdutos"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h3>Efici√™ncia da Linha</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="chartEficiencia"></canvas>
                        </div>
                    </div>
                    
                    <!-- Hist√≥rico Recente -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3>√öltimas Movimenta√ß√µes</h3>
                        </div>
                        <div class="card-body">
                            <div id="historicoRecente" class="history-list">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- GEST√ÉO DE EMPRESAS (SUPER ADMIN ONLY) -->
                <section id="gestaoEmpresasSection" class="section-module hidden">
                    <div class="module-header">
                        <div>
                            <h1 style="font-size: 1.875rem; font-weight: 600; color: #111827; margin: 0;">
                                <i class="fas fa-building" style="color: #3b82f6; margin-right: 0.5rem;"></i>
                                Gest√£o de Empresas
                            </h1>
                            <p style="color: #6b7280; margin: 0.5rem 0 0 0; font-size: 0.875rem;">Visualize, crie, edite e gerencie todas as empresas cadastradas no sistema</p>
                        </div>
                        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                            <button id="btn-nova-empresa" style="padding: 0.625rem 1.25rem; background: #10b981; color: white; border: none; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s;"
                                    onmouseover="this.style.background='#059669'" 
                                    onmouseout="this.style.background='#10b981'">
                                <i class="fas fa-plus"></i>
                                Nova Empresa
                            </button>
                            <button id="btn-refresh-empresas" style="padding: 0.625rem 1.25rem; background: #3b82f6; color: white; border: none; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s;"
                                    onmouseover="this.style.background='#2563eb'" 
                                    onmouseout="this.style.background='#3b82f6'">
                                <i class="fas fa-sync-alt"></i>
                                Atualizar
                            </button>
                        </div>
                    </div>

                    <!-- Barra de Filtros e Busca -->
                    <div style="background: white; border-radius: 12px; padding: 1.25rem; margin-top: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                            <!-- Busca -->
                            <div style="flex: 1; min-width: 280px;">
                                <div style="position: relative;">
                                    <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 0.875rem;"></i>
                                    <input type="text" 
                                           id="search-empresas" 
                                           placeholder="Buscar por nome, email, segmento ou ID..."
                                           style="width: 100%; padding: 0.625rem 0.75rem 0.625rem 2.5rem; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 0.875rem; transition: all 0.2s;"
                                           onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'"
                                           onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'">
                                </div>
                            </div>
                            
                            <!-- Filtros -->
                            <div style="display: flex; gap: 0.5rem;">
                                <button id="filtro-todas" 
                                        style="padding: 0.625rem 1rem; background: #3b82f6; color: white; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;">
                                    Todas
                                </button>
                                <button id="filtro-ativas" 
                                        style="padding: 0.625rem 1rem; background: white; color: #6b7280; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;">
                                    Ativas
                                </button>
                                <button id="filtro-inativas" 
                                        style="padding: 0.625rem 1rem; background: white; color: #6b7280; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;">
                                    Inativas
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Lista de Empresas -->
                    <div style="margin-top: 1.5rem;">
                        <div id="empresas-list-container" style="min-height: 400px;">
                            <!-- Preenchido via JS -->
                        </div>
                    </div>
                </section>

                <!-- Modal de Nova Empresa -->
                <div id="modal-nova-empresa" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 520px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);">
                        <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                            <h2 style="font-size: 1.5rem; font-weight: 600; color: white; margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-plus-circle"></i>
                                Cadastrar Nova Empresa
                            </h2>
                            <p style="color: rgba(255,255,255,0.9); margin: 0.5rem 0 0 0; font-size: 0.875rem;">Preencha os dados da empresa e do administrador</p>
                        </div>
                        
                        <div style="padding: 1.5rem;">
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                                    <i class="fas fa-building" style="color: #10b981; margin-right: 0.25rem;"></i>
                                    Nome da Empresa *
                                </label>
                                <input type="text" id="nova-nome-empresa" placeholder="Ex: Lavanderia S√£o Paulo" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                                    <i class="fas fa-tag" style="color: #10b981; margin-right: 0.25rem;"></i>
                                    Segmento *
                                </label>
                                <select id="nova-segmento" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                                    <option value="Lavanderia">üß∫ Lavanderia</option>
                                    <option value="Restaurante">üçΩÔ∏è Restaurante</option>
                                    <option value="Varejo">üõí Varejo</option>
                                    <option value="Servi√ßos">ü§ù Servi√ßos</option>
                                    <option value="Sa√∫de">‚ù§Ô∏è Sa√∫de</option>
                                    <option value="Educa√ß√£o">üìö Educa√ß√£o</option>
                                    <option value="Tecnologia">üíª Tecnologia</option>
                                    <option value="Constru√ß√£o">üèóÔ∏è Constru√ß√£o</option>
                                    <option value="Transporte">üöö Transporte</option>
                                    <option value="Outro">üì¶ Outro</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                                    <i class="fas fa-envelope" style="color: #10b981; margin-right: 0.25rem;"></i>
                                    Email do Administrador *
                                </label>
                                <input type="email" id="nova-email" placeholder="admin@empresa.com" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                                <p style="color: #6b7280; font-size: 0.75rem; margin-top: 0.25rem;">Este email ser√° usado para login do administrador</p>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                                    <i class="fas fa-phone" style="color: #10b981; margin-right: 0.25rem;"></i>
                                    Contato (Opcional)
                                </label>
                                <input type="text" id="nova-contato" placeholder="(11) 98765-4321" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                                    <i class="fas fa-lock" style="color: #10b981; margin-right: 0.25rem;"></i>
                                    Senha Inicial *
                                </label>
                                <input type="password" id="nova-senha" placeholder="M√≠nimo 6 caracteres" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                                <p style="color: #6b7280; font-size: 0.75rem; margin-top: 0.25rem;">O administrador poder√° alterar ap√≥s o primeiro login</p>
                            </div>
                        </div>
                        
                        <div style="padding: 1rem 1.5rem; background: #f9fafb; border-top: 1px solid #e5e7eb; display: flex; gap: 0.75rem; justify-content: flex-end; border-radius: 0 0 12px 12px;">
                            <button onclick="fecharModalNovaEmpresa()" style="padding: 0.625rem 1.25rem; background: #f3f4f6; color: #374151; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;">
                                Cancelar
                            </button>
                            <button onclick="cadastrarNovaEmpresa()" style="padding: 0.625rem 1.25rem; background: #10b981; color: white; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;"
                                    onmouseover="this.style.background='#059669'" 
                                    onmouseout="this.style.background='#10b981'">
                                <i class="fas fa-check"></i>
                                Cadastrar Empresa
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Modal de Edi√ß√£o de Empresa -->
                <div id="modal-editar-empresa" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);">
                        <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                            <h2 style="font-size: 1.5rem; font-weight: 600; color: white; margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-edit"></i>
                                Editar Empresa
                            </h2>
                        </div>
                        
                        <div style="padding: 1.5rem;">
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                                    <i class="fas fa-building" style="color: #3b82f6; margin-right: 0.25rem;"></i>
                                    Nome da Empresa
                                </label>
                                <input type="text" id="edit-nome-empresa" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                                    <i class="fas fa-tag" style="color: #3b82f6; margin-right: 0.25rem;"></i>
                                    Segmento
                                </label>
                                <select id="edit-segmento" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                                    <option value="Lavanderia">üß∫ Lavanderia</option>
                                    <option value="Restaurante">üçΩÔ∏è Restaurante</option>
                                    <option value="Varejo">üõí Varejo</option>
                                    <option value="Servi√ßos">ü§ù Servi√ßos</option>
                                    <option value="Sa√∫de">‚ù§Ô∏è Sa√∫de</option>
                                    <option value="Educa√ß√£o">üìö Educa√ß√£o</option>
                                    <option value="Tecnologia">üíª Tecnologia</option>
                                    <option value="Constru√ß√£o">üèóÔ∏è Constru√ß√£o</option>
                                    <option value="Transporte">üöö Transporte</option>
                                    <option value="Outro">üì¶ Outro</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                                    <i class="fas fa-envelope" style="color: #3b82f6; margin-right: 0.25rem;"></i>
                                    Email
                                </label>
                                <input type="email" id="edit-email" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                                    <i class="fas fa-phone" style="color: #3b82f6; margin-right: 0.25rem;"></i>
                                    Contato
                                </label>
                                <input type="text" id="edit-contato" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                            </div>
                        </div>
                        
                        <div style="padding: 1rem 1.5rem; background: #f9fafb; border-top: 1px solid #e5e7eb; display: flex; gap: 0.75rem; justify-content: flex-end; border-radius: 0 0 12px 12px;">
                            <button onclick="fecharModalEdicao()" style="padding: 0.625rem 1.25rem; background: #f3f4f6; color: #374151; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;">
                                Cancelar
                            </button>
                            <button onclick="salvarEdicaoEmpresa()" style="padding: 0.625rem 1.25rem; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;"
                                    onmouseover="this.style.background='#2563eb'" 
                                    onmouseout="this.style.background='#3b82f6'">
                                <i class="fas fa-check"></i>
                                Salvar Altera√ß√µes
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Modal de Confirma√ß√£o de Exclus√£o -->
                <div id="modal-confirmar-exclusao" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);">
                        <div style="padding: 1.5rem; border-bottom: 1px solid #fee2e2; background: #fef2f2; border-radius: 12px 12px 0 0;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; color: #ef4444;"></i>
                                <h2 style="font-size: 1.5rem; font-weight: 600; color: #991b1b; margin: 0;">Confirmar Exclus√£o</h2>
                            </div>
                        </div>
                        
                        <div style="padding: 1.5rem;">
                            <p style="color: #374151; font-size: 0.9375rem; line-height: 1.5; margin-bottom: 1rem;">
                                Voc√™ est√° prestes a excluir permanentemente a empresa:
                            </p>
                            
                            <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <i class="fas fa-building" style="color: #6b7280;"></i>
                                    <strong id="confirm-nome-empresa" style="color: #0f172a; font-size: 1rem;"></strong>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fas fa-fingerprint" style="color: #6b7280; font-size: 0.875rem;"></i>
                                    <code id="confirm-company-id" style="color: #6b7280; font-size: 0.8125rem; font-family: monospace;"></code>
                                </div>
                            </div>
                            
                            <div style="background: #fef2f2; border-left: 4px solid #ef4444; padding: 0.75rem; border-radius: 4px; margin-bottom: 1rem;">
                                <p style="color: #991b1b; font-size: 0.875rem; margin: 0; line-height: 1.5;">
                                    <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Esta a√ß√£o ir√° excluir a empresa e <strong>todos os seus dados</strong> (produtos, movimenta√ß√µes, funcion√°rios, transa√ß√µes financeiras). Esta a√ß√£o n√£o pode ser desfeita!
                                </p>
                            </div>
                            
                            <p style="color: #374151; font-size: 0.875rem; line-height: 1.5; margin-bottom: 0.5rem;">
                                Digite <strong style="color: #ef4444; font-family: monospace;">EXCLUIR</strong> para confirmar:
                            </p>
                            
                            <input type="text" id="confirm-text-input" placeholder="Digite EXCLUIR" style="width: 100%; padding: 0.625rem; border: 2px solid #d1d5db; border-radius: 6px; font-size: 0.875rem; font-family: monospace; text-transform: uppercase;">
                        </div>
                        
                        <div style="padding: 1rem 1.5rem; background: #f9fafb; border-top: 1px solid #e5e7eb; display: flex; gap: 0.75rem; justify-content: flex-end; border-radius: 0 0 12px 12px;">
                            <button onclick="fecharModalExclusao()" style="padding: 0.625rem 1.25rem; background: #f3f4f6; color: #374151; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;">
                                Cancelar
                            </button>
                            <button onclick="excluirEmpresa()" style="padding: 0.625rem 1.25rem; background: #ef4444; color: white; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;"
                                    onmouseover="this.style.background='#dc2626'" 
                                    onmouseout="this.style.background='#ef4444'">
                                <i class="fas fa-trash-alt"></i>
                                Confirmar Exclus√£o
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Modal de Confirma√ß√£o de Limpeza -->
                <div id="modal-confirmar-limpeza" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);">
                        <div style="padding: 1.5rem; border-bottom: 1px solid #fee2e2; background: #fef2f2; border-radius: 12px 12px 0 0;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; color: #ef4444;"></i>
                                <h2 style="font-size: 1.5rem; font-weight: 600; color: #991b1b; margin: 0;">Aten√ß√£o: A√ß√£o Irrevers√≠vel</h2>
                            </div>
                        </div>
                        
                        <div style="padding: 1.5rem;">
                            <p style="color: #374151; font-size: 0.9375rem; line-height: 1.5; margin-bottom: 1rem;">
                                Voc√™ est√° prestes a <strong style="color: #ef4444;">limpar todo o banco de dados</strong>. Esta a√ß√£o ir√° deletar permanentemente:
                            </p>
                            
                            <ul style="color: #6b7280; font-size: 0.875rem; line-height: 1.6; margin-left: 1.5rem; margin-bottom: 1rem;">
                                <li>Todas as empresas cadastradas (exceto super administrador)</li>
                                <li>Todos os produtos do estoque</li>
                                <li>Todas as movimenta√ß√µes de entrada/sa√≠da</li>
                                <li>Todos os registros financeiros</li>
                                <li>Todas as folhas de pagamento</li>
                                <li>Todos os funcion√°rios cadastrados</li>
                            </ul>
                            
                            <div style="background: #fef2f2; border-left: 4px solid #ef4444; padding: 0.75rem; border-radius: 4px; margin-bottom: 1rem;">
                                <p style="color: #991b1b; font-size: 0.875rem; font-weight: 500; margin: 0;">
                                    ‚ö†Ô∏è Esta a√ß√£o n√£o pode ser desfeita!
                                </p>
                            </div>
                            
                            <p style="color: #374151; font-size: 0.875rem; line-height: 1.5; margin: 0;">
                                Digite <strong style="color: #ef4444;">CONFIRMAR</strong> no campo abaixo para prosseguir:
                            </p>
                            
                            <input type="text" id="input-confirmar-limpeza" placeholder="Digite CONFIRMAR" style="width: 100%; padding: 0.625rem; border: 2px solid #d1d5db; border-radius: 6px; font-size: 0.875rem; margin-top: 0.75rem; font-family: monospace;">
                        </div>
                        
                        <div style="padding: 1rem 1.5rem; background: #f9fafb; border-top: 1px solid #e5e7eb; display: flex; gap: 0.75rem; justify-content: flex-end; border-radius: 0 0 12px 12px;">
                            <button id="btn-cancelar-limpeza" style="padding: 0.625rem 1.25rem; background: #f3f4f6; color: #374151; border: none; border-radius: 6px; font-size: 0.875rem; cursor: pointer; transition: all 0.2s; font-weight: 500;">
                                Cancelar
                            </button>
                            <button id="btn-confirmar-limpeza" style="padding: 0.625rem 1.25rem; background: #ef4444; color: white; border: none; border-radius: 6px; font-size: 0.875rem; cursor: pointer; transition: all 0.2s; font-weight: 500;">
                                <i class="fas fa-trash-alt"></i>
                                Confirmar Limpeza
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage"></span>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>Processando...</p>
    </div>

    <!-- Configura√ß√£o Global -->
    <script>
        // SISTEMA H√çBRIDO COM LAYOUT PRESCRIMED - Firebase Cloud + Fallback Local
        // Vers√£o 42.1 - Layout moderno com sidebar lateral
        const APP_VERSION = '42.1';
        const IS_PRODUCTION = window.location.hostname.includes('netlify.app');
        const IS_LOCALHOST = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        
        // Sistema tenta usar Firebase primeiro, fallback para localStorage se falhar
        console.log('[ENV] Ambiente:', IS_PRODUCTION ? 'PRODU√á√ÉO (Netlify)' : IS_LOCALHOST ? 'LOCAL (Dev)' : 'OUTRO');
        console.log('[SYSTEM] Vers√£o:', APP_VERSION, '- Layout PrescrMed Inspirado');
        console.log('[v42.1] Corre√ß√µes: SyntaxError firebase-config, ReferenceError dashboard, Fun√ß√µes implementadas: toggleStatusEmpresa, excluirEmpresa, exportarPDF RH completo');
        
        // Toggle Mobile Menu
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar && overlay) {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            }
        }
        
        // Toggle User Menu
        function toggleUserMenu() {
            const dropdown = document.getElementById('userMenuDropdown');
            if (dropdown) {
                dropdown.classList.toggle('hidden');
            }
        }
        
        // Fechar dropdown ao clicar fora
        document.addEventListener('click', function(event) {
            const userMenu = document.querySelector('.user-menu');
            const dropdown = document.getElementById('userMenuDropdown');
            
            if (userMenu && dropdown && !userMenu.contains(event.target)) {
                dropdown.classList.add('hidden');
            }
        });
    </script>

    <!-- JavaScript - Ordem: Firebase Config > Firestore Service > Local Fallback > Auth > App -->
    
    <!-- 1. Configura√ß√£o Firebase (Sistema H√≠brido) -->
    <script src="/static/js/firebase-config.js?v=41"></script>
    <script src="/static/js/firestore-service.js?v=41"></script>
    
    <!-- 2. Fallback Local (se Firebase falhar) -->
    <script src="/static/js/local-auth.js?v=41"></script>
    <script src="/static/js/local-firestore.js?v=41"></script>
    
    <!-- 3. Scripts de Interface e M√≥dulos -->
    <script src="/static/js/auth.js?v=42"></script>
    <script src="/static/js/admin-module.js?v=1.1"></script>
    <script src="/static/js/app.js?v=42"></script>
    <script src="/static/js/modules.js?v=42"></script>
    <script src="/static/js/dashboard.js?v=42"></script>
    <!-- gestao-empresas.js removido - funcionalidade integrada em admin-module.js -->
    <script src="/static/js/pwa.js?v=41"></script>
    
    <!-- Inicializa√ß√£o do formul√°rio de cadastro -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Popular select de segmento no formul√°rio de cadastro
            if (typeof popularSelectSegmento !== 'undefined') {
                popularSelectSegmento('regSegmento');
            }
        });
    </script>
</body>
</html>
