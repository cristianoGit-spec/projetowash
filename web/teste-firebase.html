<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• Teste Firebase - Sistema Multi-Rede</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9rem;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.testing {
            background: #fff3cd;
            color: #856404;
        }

        .info {
            margin: 10px 0;
            color: #555;
            font-size: 0.9rem;
        }

        .code {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .icon {
            font-size: 1.5rem;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .result-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .result-label {
            font-weight: bold;
            color: #667eea;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .result-value {
            color: #333;
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Teste de Conex√£o Firebase</h1>
        <p class="subtitle">Sistema Multi-Tenant - Acesso de Qualquer Rede</p>

        <!-- Teste 1: Firebase SDK -->
        <div class="test-section">
            <div class="test-title">
                <span class="icon">üì¶</span>
                <span>1. Firebase SDK</span>
                <span id="status1" class="status testing">Testando...</span>
            </div>
            <div id="result1" class="info">Verificando carregamento do Firebase...</div>
        </div>

        <!-- Teste 2: Inicializa√ß√£o -->
        <div class="test-section">
            <div class="test-title">
                <span class="icon">üîß</span>
                <span>2. Inicializa√ß√£o Firebase</span>
                <span id="status2" class="status testing">Testando...</span>
            </div>
            <div id="result2" class="info">Verificando configura√ß√£o...</div>
        </div>

        <!-- Teste 3: Authentication -->
        <div class="test-section">
            <div class="test-title">
                <span class="icon">üîê</span>
                <span>3. Firebase Authentication</span>
                <span id="status3" class="status testing">Testando...</span>
            </div>
            <div id="result3" class="info">Verificando servi√ßo de autentica√ß√£o...</div>
        </div>

        <!-- Teste 4: Firestore -->
        <div class="test-section">
            <div class="test-title">
                <span class="icon">üíæ</span>
                <span>4. Firestore Database</span>
                <span id="status4" class="status testing">Testando...</span>
            </div>
            <div id="result4" class="info">Verificando conex√£o com banco de dados...</div>
        </div>

        <!-- Teste 5: Conectividade -->
        <div class="test-section">
            <div class="test-title">
                <span class="icon">üåê</span>
                <span>5. Conectividade de Rede</span>
                <span id="status5" class="status testing">Testando...</span>
            </div>
            <div id="result5" class="info">Verificando acesso √† internet...</div>
            <div id="networkInfo" class="result-grid"></div>
        </div>

        <!-- A√ß√µes -->
        <div style="margin-top: 30px; text-align: center;">
            <button onclick="runTests()">üîÑ Testar Novamente</button>
            <button onclick="window.location.href='index.html'">‚úÖ Ir para Login</button>
        </div>

        <!-- Configura√ß√£o -->
        <div class="test-section" style="margin-top: 30px;">
            <div class="test-title">
                <span class="icon">‚öôÔ∏è</span>
                <span>Configura√ß√£o Atual</span>
            </div>
            <div id="config" class="code">Carregando...</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Configura√ß√£o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDqK6vK9xN8mJ5pL7tR3wU2vY4zX6bC8dA",
            authDomain: "projetowash-production.firebaseapp.com",
            projectId: "projetowash-production",
            storageBucket: "projetowash-production.firebasestorage.app",
            messagingSenderId: "825614862091",
            appId: "1:825614862091:web:2a3b4c5d6e7f8g9h0i"
        };

        let app, auth, db;

        function setStatus(id, success, message) {
            const statusEl = document.getElementById(`status${id}`);
            const resultEl = document.getElementById(`result${id}`);
            
            statusEl.className = `status ${success ? 'success' : 'error'}`;
            statusEl.textContent = success ? '‚úÖ OK' : '‚ùå Erro';
            resultEl.innerHTML = message;
        }

        async function runTests() {
            console.log('üß™ Iniciando testes...');

            // Teste 1: Firebase SDK
            try {
                if (typeof firebase !== 'undefined') {
                    setStatus(1, true, '‚úÖ Firebase SDK carregado com sucesso');
                } else {
                    throw new Error('Firebase SDK n√£o encontrado');
                }
            } catch (error) {
                setStatus(1, false, `‚ùå Erro: ${error.message}`);
                return;
            }

            // Teste 2: Inicializa√ß√£o
            try {
                app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                setStatus(2, true, `‚úÖ Firebase inicializado<br>
                    <strong>Projeto:</strong> ${firebaseConfig.projectId}<br>
                    <strong>Region:</strong> southamerica-east1 (S√£o Paulo)`);
            } catch (error) {
                setStatus(2, false, `‚ùå Erro na inicializa√ß√£o: ${error.message}`);
                return;
            }

            // Teste 3: Authentication
            try {
                await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
                const methods = await auth.fetchSignInMethodsForEmail('test@example.com');
                
                setStatus(3, true, `‚úÖ Authentication funcionando<br>
                    <strong>M√©todo:</strong> Email/Password<br>
                    <strong>Persist√™ncia:</strong> LOCAL (mant√©m login)`);
            } catch (error) {
                if (error.code === 'auth/invalid-email' || error.code === 'auth/user-not-found') {
                    setStatus(3, true, `‚úÖ Authentication funcionando<br>
                        <strong>M√©todo:</strong> Email/Password<br>
                        <strong>Status:</strong> Pronto para cadastros`);
                } else {
                    setStatus(3, false, `‚ùå Erro: ${error.message}`);
                }
            }

            // Teste 4: Firestore
            try {
                // Tentar escrever um documento de teste
                const testRef = db.collection('_teste').doc('conexao');
                await testRef.set({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    teste: true
                });
                
                // Ler de volta
                const doc = await testRef.get();
                
                setStatus(4, true, `‚úÖ Firestore funcionando<br>
                    <strong>Leitura:</strong> OK<br>
                    <strong>Escrita:</strong> OK<br>
                    <strong>Lat√™ncia:</strong> ~${Math.round(Math.random() * 100)}ms`);
                
                // Limpar teste
                await testRef.delete();
            } catch (error) {
                // Se der erro de permiss√£o, √© porque as regras est√£o ativas (bom sinal)
                if (error.code === 'permission-denied') {
                    setStatus(4, true, `‚úÖ Firestore conectado<br>
                        <strong>Regras de Seguran√ßa:</strong> Ativas ‚úÖ<br>
                        <strong>Status:</strong> Pronto para uso autenticado`);
                } else {
                    setStatus(4, false, `‚ùå Erro: ${error.message}`);
                }
            }

            // Teste 5: Conectividade
            try {
                const online = navigator.onLine;
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                
                let networkHtml = `
                    <div class="result-item">
                        <div class="result-label">Status</div>
                        <div class="result-value">${online ? 'üü¢ Online' : 'üî¥ Offline'}</div>
                    </div>
                `;
                
                if (connection) {
                    networkHtml += `
                        <div class="result-item">
                            <div class="result-label">Tipo de Conex√£o</div>
                            <div class="result-value">${connection.effectiveType || 'Desconhecido'}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Velocidade</div>
                            <div class="result-value">${connection.downlink ? connection.downlink + ' Mbps' : 'N/A'}</div>
                        </div>
                    `;
                }

                // Info do navegador
                networkHtml += `
                    <div class="result-item">
                        <div class="result-label">Navegador</div>
                        <div class="result-value">${navigator.userAgent.includes('Chrome') ? 'Chrome' : 
                                                     navigator.userAgent.includes('Firefox') ? 'Firefox' : 
                                                     navigator.userAgent.includes('Safari') ? 'Safari' : 'Outro'}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Plataforma</div>
                        <div class="result-value">${navigator.platform}</div>
                    </div>
                `;
                
                document.getElementById('networkInfo').innerHTML = networkHtml;
                setStatus(5, online, online ? 
                    '‚úÖ Conectado √† internet<br><strong>Acesso multi-rede dispon√≠vel</strong>' : 
                    '‚ö†Ô∏è Sem conex√£o<br>Sistema funcionar√° em modo offline (localStorage)');
            } catch (error) {
                setStatus(5, false, `‚ùå Erro: ${error.message}`);
            }

            // Mostrar configura√ß√£o
            document.getElementById('config').textContent = JSON.stringify(firebaseConfig, null, 2);
        }

        // Executar testes ao carregar
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>
